(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{3757:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var n=s(7876),a=s(4232);function o(){let[e,t]=(0,a.useState)(null),[s,o]=(0,a.useState)(null),[r,i]=(0,a.useState)(!1),[l,c]=(0,a.useState)(null),[d,g]=(0,a.useState)(null),[u,f]=(0,a.useState)(!1),h=async()=>{console.log("\uD83D\uDE80 Starting Basiq integration flow..."),i(!0),t(null),o(null);try{console.log("\uD83D\uDC64 Step 1: Creating Basiq user...");let e=await fetch("/api/basiq-create-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:"test@example.com",mobile:"+61400000000"})});if(!e.ok){let t=await e.json();throw Error("Failed to create user: ".concat(t.message))}let t=await e.json();console.log("✅ Step 1 Complete: User created with ID:",t.basiqUserId),c(t.basiqUserId),console.log("\uD83D\uDD17 Step 2: Generating consent URL...");let s=await fetch("/api/basiq-consent-url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({basiqUserId:t.basiqUserId})});if(!s.ok){let e=await s.json();throw Error("Failed to generate consent URL: ".concat(e.message))}let n=await s.json();console.log("✅ Step 2 Complete: Consent URL generated"),console.log("\uD83D\uDD04 Step 3: Redirecting to Basiq Consent UI..."),o("✅ Redirecting to Basiq Consent UI..."),window.open(n.consentUrl,"_blank"),o("✅ Consent UI opened! Complete the bank connection in the new tab, then come back here.")}catch(e){console.error("❌ Basiq flow failed:",e),t("❌ Basiq flow failed: "+e.message)}finally{i(!1)}},m=async()=>{if(!l)return void t("❌ No Basiq User ID. Please complete the consent flow first.");console.log("\uD83D\uDCCA Testing transaction fetch..."),f(!0),t(null);try{let e=await fetch("/api/basiq-auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scope:"SERVER_ACCESS"})});if(!e.ok)throw Error("Failed to get auth token");let s=await e.json(),n=await fetch("/api/basiq-transactions?basiqUserId=".concat(l),{method:"GET",headers:{Authorization:"Bearer ".concat(s.access_token)}});console.log("\uD83D\uDCCA Transaction API Response status:",n.status);let a=await n.json();console.log("\uD83D\uDCCA Transaction API Response:",a),n.ok?(o("✅ Transactions fetched successfully!"),g(a)):t("❌ Transaction fetch failed: ".concat(a.message||"Unknown error"))}catch(e){console.error("❌ Transaction test failed:",e),t("❌ Transaction test failed: "+e.message)}finally{f(!1)}};return(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-2xl p-8 w-full max-w-md border border-gray-700/50",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-center text-gray-100 mb-8",children:"\uD83D\uDE80 Next.js App Ready!"}),e&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-200 text-sm",children:e}),s&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-green-500/20 border border-green-500/50 rounded-lg text-green-200 text-sm",children:s}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("p",{className:"text-center text-gray-300 mb-6",children:"Complete Basiq Integration with Consent Flow"}),(0,n.jsx)("button",{onClick:h,disabled:r,className:"w-full flex justify-center py-3 px-4 rounded-lg shadow-sm text-sm font-bold transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 focus:ring-offset-gray-900 ".concat(r?"bg-gray-600 cursor-not-allowed text-gray-400":"bg-green-600 hover:bg-green-700 text-white"),children:r?(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Starting Basiq Flow..."]}):"\uD83D\uDE80 Start Basiq Consent Flow"}),l&&(0,n.jsx)("button",{onClick:m,disabled:u,className:"w-full flex justify-center py-3 px-4 rounded-lg shadow-sm text-sm font-bold transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 focus:ring-offset-gray-900 ".concat(u?"bg-gray-600 cursor-not-allowed text-gray-400":"bg-blue-600 hover:bg-blue-700 text-white"),children:u?(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Fetching Transactions..."]}):"\uD83D\uDCCA Test Fetch Transactions"}),(0,n.jsxs)("div",{className:"text-center text-gray-400 text-sm space-y-1",children:[(0,n.jsx)("p",{children:"✅ Next.js server running on port 3000"}),(0,n.jsx)("p",{children:"✅ API routes available at /api/*"}),(0,n.jsx)("p",{children:"✅ Basiq consent flow ready!"}),l&&(0,n.jsxs)("p",{className:"text-green-400",children:["✅ Basiq User ID: ",l.substring(0,8),"..."]})]}),d&&(0,n.jsxs)("div",{className:"mt-6 p-4 bg-gray-700/50 rounded-lg",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-200 mb-2",children:"Bank Data:"}),(0,n.jsx)("pre",{className:"text-xs text-gray-300 overflow-auto max-h-40",children:JSON.stringify(d,null,2)})]})]})]})})}},6760:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(3757)}])}},e=>{e.O(0,[636,593,792],()=>e(e.s=6760)),_N_E=e.O()}]);